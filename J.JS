document.addEventListener('DOMContentLoaded', () => {

    // --- TRANSLATIONS & LANGUAGE SWITCHER ---
    const translations = {
        en: {
            brand: "YG",
            nav_about: "About",
            nav_offers: "Offers",
            nav_portfolio: "Portfolio",
            nav_skills: "Skills",
            nav_testimonials: "Testimonials",
            nav_contact: "Contact",
            hero_name: "Youssef Ghannam",
            hero_tagline: "Graphic Designer & Video Editor",
            hero_button: "Discover More",
            about_title: "About Me",
            about_p1: "Every successful project begins with one simple question: how can we deliver the right idea?<br><br>I'm Yousef Ghannam โ a graphic designer and video editor with over 3 years of hands-on experience. Throughout my journey, Iโve collaborated with more than 40 clients across various industries, including education and food & beverage, helping brands communicate visually and connect meaningfully with their audiences. My work includes redesigning the visual identity for two restaurant brands, which resulted in a 120% increase in engagement in just one month. I've also created over 150 pieces of visual content โ from book covers and YouTube thumbnails to Reels โ that have helped educators increase their reach and demand. Although I didnโt formally study design, my passion for the field led me to learn through real-world experience, continuous practice, and a deep understanding of what works in todayโs market. My focus remains on crafting compelling brand identities, editing engaging videos, and designing visuals that not only look good but serve a purpose.",
            offers_title: "Special Offers",

            // Weekly Package
            offer1_title: "Weekly Follow-up",
            offer1_f1: "4 Pro Montage Videos (1/Week)",
            offer1_f2: "4 Attractive Thumbnails",
            offer1_f3: "Audio & Video Quality Improvement",
            offer1_f4: "Fast Delivery (48h)",
            offer1_f5: "Suggested Posting Plan (Bonus)",

            // Intensive Package
            offer2_title: "Intensive Curriculum",
            offer2_f1: "8 Explainer Videos (2/Week)",
            offer2_f2: "8 Professional Thumbnails",
            offer2_f3: "4 Ad Poster Designs",
            offer2_f4: "Free Ad Campaign Management",
            offer2_f5: "Camera Presence Tips",
            offer2_f6: "4 Strong Reels",

            // Viral Package (Best Value)
            offer3_title: "Viral & Trending",
            offer3_f1: "6 Long Explainer Videos",
            offer3_f2: "3 Viral Style Reels",
            offer3_f3: "6 High-Quality Thumbnails",
            offer3_f4: "6 Strong Ad Posters",
            offer3_f5: "Interactive Content Plan",
            offer3_f6: "Top Priority for Execution & Edits",
            offer3_extra: "2 Review/Rules Posters",
            offer1_extra: "Review Poster",
            offer2_extra: "Book Cover Design",
            offer2_new1: "Rules Poster or Summary",
            offer2_new2: "Certificate",
            offer2_new3: "Ad Campaign Scheduling File (free)",
            offer2_f3: "8 Social Media Ad Posters",

            best_value: "Best Value",
            contact_for_price: "Contact for Price",
            portfolio_title: "Some of My Work",
            portfolio_button: "View Project",
            portfolio1_title: "Restaurant Brand Redesign",
            portfolio1_p: "Led a complete brand identity overhaul for two local restaurants, significantly boosting their online presence and customer interaction.",
            portfolio2_title: "Educational Content Series",
            portfolio2_p: "Designed and produced over 150 engaging visual materials for educational services, including presentations, infographics, and video overlays.",
            portfolio3_title: "Reels Video Editing",
            portfolio3_p: "Specialized in fast-paced and engaging video editing for social media Reels and advertisements, optimizing content for maximum retention.",
            portfolio4_title: "Thumbnail Design",
            portfolio4_p: "Created captivating and click-worthy thumbnails for YouTube videos. Focused on visual hierarchy and compelling imagery to increase click-through rates.",
            portfolio5_title: "BUNZ โ Restaurant Brand Identity Design",
            portfolio5_p: "Created a full visual identity for BUNZ, a modern burger restaurant. The project included logo design, color palette, typography, and branded packaging, helping establish a bold and cohesive brand presence.",
            skills_title: "Skills",
            skill1_title: "Graphic Design",
            skill1_p: "Mastering Adobe tools like Photoshop, Illustrator, and InDesign.",
            skill2_title: "Video Editing & Production",
            skill2_p: "Proficient in Adobe Premiere Pro & CapCut for producing professional videos.",
            skill5_title: "Creativity & Innovation",
            skill5_p: "Generating fresh and original ideas and delivering unique design solutions.",
            skill7_title: "Communication & Collaboration",
            skill7_p: "Building strong client relationships and working effectively within teams.",
            testimonials_title: "Testimonials",
            contact_title: "Ready to Bring Your Vision to Life?",
            contact_p: "Let's connect and discuss how I can help your brand shine.",
            contact_whatsapp: "WhatsApp",
            footer_text: "&copy; 2025 Youssef Ghannam. All rights reserved.",
            custom_pkg_title: "Design Your Own Package",
            custom_pkg_desc: "These are standard individual rates. (Save more by choosing our monthly packages above ๐)",
            srv_filming: "Lecture Filming",
            srv_filming_note: "Select Lectures & Duration per Lecture",
            lbl_lectures: "Lectures",
            lbl_hours_per_lec: "Hours/Lecture",
            srv_thumbnail: "Thumbnail",
            srv_thumbnail_note: "High Quality",
            srv_reels: "Reels Video (1 Minute)",
            srv_reels_note: "Pro Editing",
            srv_ad: "Ad Design",
            srv_ad_note: "Social Media Poster",
            srv_book_cover: "Book Cover",
            srv_book_cover_note: "Professional Print Design",
            srv_certificate: "Certificate",
            srv_certificate_note: "Honorary Design for Students",
            srv_rules_poster: "Rules Poster",
            srv_rules_poster_note: "Classroom Guidelines Design",
            custom_total_label: "Estimated Total:",
            custom_send_btn: "Send Request Now",
            custom_calc_btn: "Calculate Price",
            custom_edit_btn: "Edit",
            custom_hint: "For better rates, check our monthly packages above!"
        },
        ar: {
            brand: "YG",
            nav_about: "ูู ุฃูุง",
            nav_offers: "ุงูุนุฑูุถ",
            nav_portfolio: "ุฃุนูุงูู",
            nav_skills: "ุงูููุงุฑุงุช",
            nav_testimonials: "ุขุฑุงุก ุงูุนููุงุก",
            nav_contact: "ุชูุงุตู ูุนู",
            hero_name: "ููุณู ุบูุงู",
            hero_tagline: "ูุตูู ุฌุฑุงููู ููุญุฑุฑ ููุฏูู",
            hero_button: "ุงูุชุดู ุงููุฒูุฏ",
            about_title: "ูู ุฃูุง",
            about_p1: "ูู ูุดุฑูุน ูุงุฌุญ ูุจุฏุฃ ุจุณุคุงู ุจุณูุท ูุงุญุฏ: ููู ููุฏูู ุงูููุฑุฉ ุงูุตุญูุญุฉุ ุฃูุง ููุณู ุบูุงู โ ูุตูู ุฌุฑุงููู ููุญุฑุฑ ููุฏูู ุจุฎุจุฑุฉ ุนูููุฉ ุชุฒูุฏ ุนู 3 ุณููุงุช. ุฎูุงู ุฑุญูุชูุ ุชุนุงููุช ูุน ุฃูุซุฑ ูู 40 ุนููู ูู ูุฎุชูู ุงููุฌุงูุงุชุ ุจูุง ูู ุฐูู ุงูุชุนููู ูุงูุฃุบุฐูุฉ ูุงููุดุฑูุจุงุชุ ูุณุงุนุฏุช ุงูุนูุงูุงุช ุงูุชุฌุงุฑูุฉ ุนูู ุงูุชูุงุตู ุจุตุฑููุง ูุงูุชูุงุตู ุจุดูู ูุงุฏู ูุน ุฌูุงููุฑูุง. ูุชุถูู ุนููู ุฅุนุงุฏุฉ ุชุตููู ุงููููุฉ ุงูุจุตุฑูุฉ ูุนูุงูุชูู ุชุฌุงุฑูุชูู ููุทุงุนูุ ููุง ุฃุฏู ุฅูู ุฒูุงุฏุฉ ุจูุณุจุฉ 120ูช ูู ุงูุชูุงุนู ุฎูุงู ุดูุฑ ูุงุญุฏ ููุท. ููุง ููุช ุจุฅูุดุงุก ุฃูุซุฑ ูู 150 ูุทุนุฉ ูู ุงููุญุชูู ุงููุฑุฆู โ ูู ุฃุบููุฉ ุงููุชุจ ูุงูุตูุฑ ุงููุตุบุฑุฉ ุนูู ููุชููุจ ุฅูู ููุงุทุน Reels โ ูุงูุชู ุณุงุนุฏุช ุงููุนูููู ุนูู ุฒูุงุฏุฉ ุงูุชุดุงุฑูู ูุงูุทูุจ ุนูู ุฎุฏูุงุชูู. ุนูู ุงูุฑุบู ูู ุฃููู ูู ุฃุฏุฑุณ ุงูุชุตููู ุจุดูู ุฑุณููุ ุฅูุง ุฃู ุดุบูู ุจุงููุฌุงู ุฏูุนูู ููุชุนูู ูู ุฎูุงู ุงูุฎุจุฑุฉ ุงููุงูุนูุฉุ ูุงูููุงุฑุณุฉ ุงููุณุชูุฑุฉุ ูุงูููู ุงูุนููู ููุง ููุฌุญ ูู ุณูู ุงูููู. ูุจูู ุชุฑููุฒู ุนูู ุตูุงุบุฉ ูููุงุช ุชุฌุงุฑูุฉ ูููุนุฉุ ูุชุญุฑูุฑ ููุฏูููุงุช ุฌุฐุงุจุฉุ ูุชุตููู ูุฑุฆูุงุช ูุง ุชุจุฏู ุฌูุฏุฉ ูุญุณุจุ ุจู ุชุฎุฏู ูุฏูุงู ูุญุฏุฏุงู.",
            offers_title: "ุจุงูุงุช ุงูุนุฑูุถ ุงูุฎุงุตุฉ",

            // Weekly Package (Arabic)
            offer1_title: "ุจุงูุฉ ุงููุชุงุจุนุฉ ุงูุฃุณุจูุนูุฉ",
            offer1_f1: "4 ููุฏูููุงุช ูููุชุงุฌ ุงุญุชุฑุงูู (ููุฏูู ูู ุฃุณุจูุน)",
            offer1_f2: "4 ุตูุฑ ูุตุบุฑุฉ (Thumbnails) ุฌุฐุงุจุฉ",
            offer1_f3: "ุชุญุณูู ุฌูุฏุฉ ุงูุตูุช ูุงูุตูุฑุฉ ุงูุญุงููุฉ",
            offer1_f4: "ุชุณููู ุณุฑูุน ุฎูุงู 48 ุณุงุนุฉ ูู ุงูุชุตููุฑ",
            offer1_f5: "ุฎุทุฉ ูุดุฑ ููุชุฑุญุฉ (Bonus)",

            offer1_extra: "ุจูุณุชุฑ ูุฑุงุฌุนุฉ",

            // Intensive Package (Arabic)
            offer2_title: "ุจุงูุฉ ุงููููุฌ ุงูููุซู",
            offer2_f1: "8 ููุฏูููุงุช ุดุฑุญ/ูุญุชูู (2 ุฃุณุจูุนูุงู)",
            offer2_f2: "8 ุตูุฑ ูุตุบุฑุฉ ุงุญุชุฑุงููุฉ",
            offer2_f3: "8 ุชุตูููุงุช ุจูุณุชุฑุฒ ููุณูุดูุงู ููุฏูุง ููุฅุนูุงูุงุช",
            offer2_f4: "ููู ุฅุฏุงุฑุฉ ุฌุฏููุฉ ุงูุญููุงุช ุงูุฅุนูุงููุฉ ูุฌุงูุงู (Setup & Monitoring)",
            offer2_f5: "ูุตุงุฆุญ ูุชุญุณูู ุงูุธููุฑ ุฃูุงู ุงููุงููุฑุง",
            offer2_f6: "4 ููุฏูููุงุช ุฑููุฒ ูููุฉ",
            offer2_extra: "ุชุตููู ุบูุงู ูุฐูุฑุฉ",
            offer2_new1: "ุชุตููู ุจูุณุชุฑ ููุงููู ุฃู ููุฎุต",
            offer2_new2: "ุดูุงุฏุฉ ุชูุฏูุฑ",

            // Viral Package (Arabic) - FEATURED
            offer3_title: "ุจุงูุฉ ุงูุงูุชุดุงุฑ ูุงูุชุฑููุฏ",
            offer3_f1: "6 ููุฏูููุงุช ุดุฑุญ ุทูููุฉ (ููุชููุจ/ููุณุจูู)",
            offer3_f2: "3 ููุฏูููุงุช ุฑููุฒ ุณุฑูุนุฉ ุงูุงูุชุดุงุฑ (Viral Style)",
            offer3_f3: "6 ุตูุฑ ูุตุบุฑุฉ ุนุงููุฉ ุงูุฌูุฏุฉ",
            offer3_f4: "6 ุจูุณุชุฑุงุช ุฅุนูุงููุฉ ูููุฉ",
            offer3_f5: "ุฎุทุฉ ูุญุชูู ุชูุงุนููุฉ ูุฒูุงุฏุฉ ุงููุชุงุจุนูู",
            offer3_f6: "ุฃููููุฉ ูุตูู ูู ุงูุชูููุฐ ูุงูุชุนุฏููุงุช",
            offer3_extra: "2 ุจูุณุชุฑ ุงูููุงููู ูุฑุงุฌุนุฉ",

            best_value: "ุงูุฃูุซุฑ ุทูุจุงู (Best Value)",
            contact_for_price: "ุชูุงุตู ููุณุนุฑ",
            portfolio_title: "ุจุนุถ ูู ุฃุนูุงูู",
            portfolio_button: "ุนุฑุถ ุงููุดุฑูุน",
            portfolio1_title: "ุฅุนุงุฏุฉ ุชุตููู ุนูุงูุฉ ุชุฌุงุฑูุฉ ููุทุนู",
            portfolio1_p: "ููุช ุจุฅุนุงุฏุฉ ุชุตููู ุงููููุฉ ุงูุชุฌุงุฑูุฉ ุงููุงููุฉ ููุทุนููู ูุญููููุ ููุง ุฃุฏู ุฅูู ุชุนุฒูุฒ ูุฌูุฏูู ุนูู ุงูุฅูุชุฑูุช ูุชูุงุนู ุงูุนููุงุก ุจุดูู ูุจูุฑ.",
            portfolio2_title: "ุณูุณูุฉ ูุญุชูู ุชุนูููู",
            portfolio2_p: "ุตููุช ูุฃูุชุฌุช ุฃูุซุฑ ูู 150 ูุงุฏุฉ ูุฑุฆูุฉ ุฌุฐุงุจุฉ ููุฎุฏูุงุช ุงูุชุนููููุฉุ ุจูุง ูู ุฐูู ุงูุนุฑูุถ ุงูุชูุฏูููุฉ ูุงูุฑุณูู ุงูุจูุงููุฉ ูุชุฑุงูุจุงุช ุงูููุฏูู.",
            portfolio3_title: "ูููุชุงุฌ ููุฏูููุงุช Reels",
            portfolio3_p: "ูุชุฎุตุต ูู ุชุญุฑูุฑ ุงูููุฏูู ุณุฑูุน ุงูุฎุทู ูุงูุฌุฐุงุจ ูููุงุทุน Reels ูุงูุฅุนูุงูุงุช ุนูู ูุณุงุฆู ุงูุชูุงุตู ุงูุงุฌุชูุงุนูุ ูุน ุชุญุณูู ุงููุญุชูู ูุชุญููู ุฃูุตู ูุฏุฑ ูู ุงูุงุญุชูุงุธ.",
            portfolio4_title: "ุชุตููู ุงูุตูุฑ ุงููุตุบุฑุฉ",
            portfolio4_p: "ููุช ุจุฅูุดุงุก ุตูุฑ ูุตุบุฑุฉ ุฌุฐุงุจุฉ ููุบุฑูุฉ ููููุฑ ูููุงุทุน ููุฏูู ููุชููุจ. ุฑูุฒุช ุนูู ุงูุชุณูุณู ุงููุฑูู ุงูุจุตุฑู ูุงูุตูุฑ ุงููููุนุฉ ูุฒูุงุฏุฉ ูุนุฏูุงุช ุงูููุฑ.",
            portfolio5_title: "BUNZ โ ุชุตููู ูููุฉ ุจุตุฑูุฉ ููุทุนู",
            portfolio5_p: "ุชู ุฅูุดุงุก ูููุฉ ุจุตุฑูุฉ ูุงููุฉ ูู BUNZุ ููู ูุทุนู ุจุฑุฌุฑ ุนุตุฑู. ุดูู ุงููุดุฑูุน ุชุตููู ุงูุดุนุงุฑุ ูููุญุฉ ุงูุฃููุงูุ ูุงูุฎุทูุทุ ูุงูุชุบูููุ ููุง ุณุงุนุฏ ุนูู ุชุฃุณูุณ ุญุถูุฑ ููู ููุชูุงุณู ููุนูุงูุฉ ุงูุชุฌุงุฑูุฉ.",
            skills_title: "ุงูููุงุฑุงุช",
            skill1_title: "ุงูุชุตููู ุงูุฌุฑุงูููู",
            skill1_p: "ุฅุชูุงู ุฃุฏูุงุช Adobe ูุซู ููุชูุดูุจุ ุฅููุณุชุฑูุชูุฑุ ูุฅู ุฏูุฒุงูู.",
            skill2_title: "ุชุญุฑูุฑ ููููุชุงุฌ ุงูููุฏูู",
            skill2_p: "ุฎุจุฑุฉ ูู ุงุณุชุฎุฏุงู Adobe Premiere Pro ู CapCut ูุฅูุชุงุฌ ููุฏูููุงุช ุงุญุชุฑุงููุฉ.",
            skill5_title: "ุงูุฅุจุฏุงุน ูุงูุงุจุชูุงุฑ",
            skill5_p: "ุชูููุฏ ุฃููุงุฑ ุฌุฏูุฏุฉ ูุชูุฏูู ุญููู ุชุตููู ูุฑูุฏุฉ.",
            skill7_title: "ุงูุชูุงุตู ูุงูุชุนุงูู",
            skill7_p: "ุจูุงุก ุนูุงูุงุช ูููุฉ ูุน ุงูุนููุงุก ูุงูุนูู ุจูุนุงููุฉ ุถูู ูุฑู.",
            testimonials_title: "ุขุฑุงุก ุงูุนููุงุก",
            contact_title: "ูู ุฃูุช ูุณุชุนุฏ ูุชุญููู ุฑุคูุชู ุฅูู ุญูููุฉุ",
            contact_p: "ููุชูุงุตู ูููุงูุด ููู ูููููู ูุณุงุนุฏุฉ ุนูุงูุชู ุงูุชุฌุงุฑูุฉ ุนูู ุงูุชุฃูู.",
            contact_whatsapp: "ูุงุชุณุงุจ",
            contact_instagram: "ุงูุณุชุบุฑุงู",
            contact_email: "ุงูุจุฑูุฏ ุงูุฅููุชุฑููู",
            footer_text: "ยฉ 2025 ููุณู ุบูุงู. ุฌููุน ุงูุญููู ูุญููุธุฉ.",
            custom_pkg_title: "ุตูู ุจุงูุชู ุจููุณู",
            custom_pkg_desc: "ุงูุฃุณุนุงุฑ ููุง ูู ุฃุณุนุงุฑ ุงูุฎุฏูุงุช ุงููุฑุฏูุฉ. (ููุฑ ุฃูุซุฑ ุจุงุฎุชูุงุฑ ุงูุจุงูุงุช ุงูุดูุฑูุฉ ุจุงูุฃุนูู ๐)",
            srv_filming: "ุชุตููุฑ ูุญุงุถุฑุงุช (ููุฏูู)",
            srv_filming_note: "ุญุฏุฏ ุนุฏุฏ ุงููุญุงุถุฑุงุช ููุฏุฉ ุงููุญุงุถุฑุฉ ุงููุงุญุฏุฉ",
            lbl_lectures: "ุงููุญุงุถุฑุงุช",
            lbl_hours_per_lec: "ุณุงุนุงุช ููู ูุญุงุถุฑุฉ",
            srv_thumbnail: "ุตูุฑุฉ ูุตุบุฑุฉ (Thumbnail)",
            srv_thumbnail_note: "ุฌูุฏุฉ ุนุงููุฉ ุฌุฐุงุจุฉ",
            srv_reels: "ููุฏูู ุฑููุฒ (1 ุฏูููุฉ)",
            srv_reels_note: "ูููุชุงุฌ ุงุญุชุฑุงูู ุณุฑูุน",
            srv_ad: "ุชุตููู ุฅุนูุงู (Poster)",
            srv_ad_note: "ุณูุดูุงู ููุฏูุง",
            srv_book_cover: "ุบูุงู ูุฐูุฑุฉ (Book Cover)",
            srv_book_cover_note: "ุชุตููู ุงุญุชุฑุงูู ุฌุงูุฒ ููุทุจุงุนุฉ",
            srv_certificate: "ุดูุงุฏุฉ ุชูุฏูุฑ (Certificate)",
            srv_certificate_note: "ุชุตููู ูููุฒ ูุชูุฑูู ุงูุทูุงุจ",
            srv_rules_poster: "ุจูุณุชุฑ ุงูููุงููู (Rules)",
            srv_rules_poster_note: "ุชุตููู ุฅุฑุดุงุฏู ูููุงุนุฉ/ุงูุณูุชุฑ",
            custom_total_label: "ุงูุณุนุฑ ุงูุฅุฌูุงูู (Individual Pricing):",
            custom_send_btn: "ุฃุฑุณู ุงูุทูุจ ุงูุขู",
            custom_calc_btn: "ุงุญุณุจ ุงูุณุนุฑ",
            custom_edit_btn: "ุชุนุฏูู",
            custom_hint: "ููุญุตูู ุนูู ุฃุณุนุงุฑ ุฃููุฑุ ุฑุงุฌุน ุงูุจุงูุงุช ุงูุดูุฑูุฉ ุจุงูุฃุนูู!"
        }
    };

    function updateLanguage(lang) {
        document.querySelectorAll('[data-lang-key]').forEach(element => {
            const key = element.getAttribute('data-lang-key');
            if (translations[lang][key]) {
                if (element.children.length > 0 && element.tagName === 'LI') {
                    // Preserve icon for list items
                    const icon = element.querySelector('i');
                    element.innerHTML = '';
                    if (icon) element.appendChild(icon);
                    element.appendChild(document.createTextNode(' ' + translations[lang][key]));
                } else if (element.children.length > 0 && element.tagName === 'A') {
                    // Button with icon
                    const icon = element.querySelector('i');
                    const span = element.querySelector('span');
                    if (span) span.innerText = translations[lang][key];
                    else element.innerText = translations[lang][key];
                } else {
                    element.textContent = translations[lang][key];
                }
            }
        });
        document.documentElement.lang = lang;
        document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';

        if (typeof SplitType !== 'undefined' && document.querySelector('#about-content p')) {
            try {
                const aboutP = document.querySelector('#about-content p');
                aboutP.style.opacity = '1';
                new SplitType(aboutP, { types: 'words' });
            } catch (e) { }
        }
    }

    // Add event listener for Lang Switcher
    const langSwitcher = document.getElementById('lang-switcher');
    if (langSwitcher) {
        langSwitcher.addEventListener('click', () => {
            const currentLang = document.documentElement.lang;
            const newLang = currentLang === 'ar' ? 'en' : 'ar';
            langSwitcher.textContent = newLang === 'ar' ? 'English' : 'ุนุฑุจู';
            updateLanguage(newLang);
        });
    }

    // Set Initial Content
    const initialLang = document.documentElement.lang || 'ar';
    if (document.querySelector('#about-content p') && document.querySelector('#about-content p').innerText.trim() === '') {
        document.querySelector('#about-content p').innerText = translations[initialLang].about_p1;
    }

    // --- GENERIC UTILS (Theme, Nav, Cursor) ---
    const themeSwitcher = document.getElementById('theme-switcher');
    const body = document.body;
    const themeIcon = themeSwitcher ? themeSwitcher.querySelector('i') : null;
    if (themeSwitcher) {
        themeSwitcher.addEventListener('click', () => {
            const current = localStorage.getItem('theme') || 'dark';
            const next = current === 'dark' ? 'light' : 'dark';
            localStorage.setItem('theme', next);
            body.classList.toggle('light-mode', next === 'light');
            if (themeIcon) {
                themeIcon.classList.toggle('fa-sun', next === 'dark');
                themeIcon.classList.toggle('fa-moon', next === 'light');
            }
        });
        const savedTheme = localStorage.getItem('theme') || 'dark';
        body.classList.toggle('light-mode', savedTheme === 'light');
        if (themeIcon) {
            themeIcon.classList.toggle('fa-sun', savedTheme === 'dark');
            themeIcon.classList.toggle('fa-moon', savedTheme === 'light');
        }
    }

    // Mobile Nav
    const navToggle = document.querySelector('.nav-toggle');
    const navLinks = document.querySelector('.nav-links');
    if (navToggle && navLinks) {
        navToggle.addEventListener('click', () => {
            navLinks.classList.toggle('nav-open');
            navToggle.classList.toggle('nav-open');
            document.body.classList.toggle('no-scroll');
        });
        navLinks.querySelectorAll('a, button').forEach(l => {
            l.addEventListener('click', () => {
                navLinks.classList.remove('nav-open');
                navToggle.classList.remove('nav-open');
                document.body.classList.remove('no-scroll');
            });
        });
    }

    // Custom Cursor
    const cursorDot = document.querySelector('.cursor-dot');
    const cursorOutline = document.querySelector('.cursor-outline');
    window.addEventListener('mousemove', (e) => {
        const posX = e.clientX;
        const posY = e.clientY;
        if (cursorDot) { cursorDot.style.left = `${posX}px`; cursorDot.style.top = `${posY}px`; }
        if (cursorOutline) cursorOutline.animate({ left: `${posX}px`, top: `${posY}px` }, { duration: 500, fill: "forwards" });
    });
    document.querySelectorAll('a, button, .card, input, label').forEach((el) => {
        el.addEventListener('mouseover', () => cursorOutline?.classList.add('cursor-interact'));
        el.addEventListener('mouseleave', () => cursorOutline?.classList.remove('cursor-interact'));
    });

    // Smooth Scroll
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const targetId = this.getAttribute('href');
            const targetElement = document.querySelector(targetId);
            if (targetElement) {
                const navbarHeight = document.querySelector('.navbar').offsetHeight;
                const offsetPosition = targetElement.offsetTop - navbarHeight - 20;
                window.scrollTo({ top: offsetPosition, behavior: 'smooth' });
            }
        });
    });

    // Particle BG
    const canvas = document.getElementById('particle-canvas');
    if (canvas) {
        const ctx = canvas.getContext('2d');
        let particles = [];
        const numParticles = 50;
        const initParticles = () => {
            particles = [];
            for (let i = 0; i < numParticles; i++) {
                const r = Math.random() * 2 + 1;
                const x = Math.random() * (canvas.width - r * 2) + r;
                const y = Math.random() * (canvas.height - r * 2) + r;
                const c = body.classList.contains('light-mode') ? 'rgba(4, 54, 74, 0.4)' : `rgba(100, 204, 197, ${Math.random() * 0.3 + 0.1})`;
                const v = { x: (Math.random() - 0.5) * 0.5, y: (Math.random() - 0.5) * 0.5 };
                particles.push({ x, y, r, c, v });
            }
        };
        const animate = () => {
            requestAnimationFrame(animate);
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particles.forEach(p => {
                if (p.x + p.r > canvas.width || p.x - p.r < 0) p.v.x = -p.v.x;
                if (p.y + p.r > canvas.height || p.y - p.r < 0) p.v.y = -p.v.y;
                p.x += p.v.x; p.y += p.v.y;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
                ctx.fillStyle = p.c;
                ctx.fill();
            });
        };
        const resize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; initParticles(); };
        window.addEventListener('resize', resize);
        resize();
        animate();
    }

    // Tilt
    if (window.innerWidth > 768 && typeof VanillaTilt !== 'undefined') {
        VanillaTilt.init(document.querySelectorAll(".card"), { max: 10, speed: 400, glare: true, "max-glare": 0.2 });
    }

    // --- ๐ NEW FEATURE: PACKAGE DETAILS OVERLAY & DATA (UPDATED) ---
    const packagesData = {
        'basic': {
            title: 'ุจุงูุฉ ุงููุชุงุจุนุฉ ุงูุฃุณุจูุนูุฉ',
            image: '../images/BAC1.png',
            audience: 'ูุซุงููุฉ ูููุฏุฑุณูู ุงูุฌุฏุฏ ุฃู ุตูุงุน ุงููุญุชูู ุงูุฐูู ูุฑุบุจูู ูู ุงูุงุณุชูุฑุงุฑูุฉ ุจูุญุชูู ุซุงุจุช ููุชููุฒ ุดูุฑูุงู.',
            features: [
                '4 ููุฏูููุงุช ูููุชุงุฌ ุงุญุชุฑุงูู (ููุฏูู ูู ุฃุณุจูุน)',
                '4 ุตูุฑ ูุตุบุฑุฉ (Thumbnails) ุฌุฐุงุจุฉ ูุฒูุงุฏุฉ ุงูููุฑุงุช',
                'ุชุณููู ุณุฑูุน ุฎูุงู 48 ุณุงุนุฉ ูู ุงูุชุตููุฑ',
                'ุฎุทุฉ ูุดุฑ ููุชุฑุญุฉ (Bonus)',
                'ุจูุณุชุฑ ูุฑุงุฌุนุฉ'
            ],
            price: '1500 EGP <span style="font-size:0.5em; text-decoration:line-through; color:#aaa">2000</span>'
        },
        'pro': {
            title: 'ุจุงูุฉ ุงููููุฌ ุงูููุซู',
            image: '../images/BAC2.png',
            audience: 'ุตููุช ุฎุตูุตุงู ูููุฏุฑุณูู ุงูุฐูู ูุตูุฑูู ูููุฌุงู ูุงููุงู ููุญุชุงุฌูู ุฅูู ุฅูุชุงุฌ ุบุฒูุฑ ุจุฌูุฏุฉ ุนุงููุฉ.',
            features: [
                '8 ููุฏูููุงุช ุดุฑุญ/ูุญุชูู (2 ุฃุณุจูุนูุงู)',
                '8 ุตูุฑ ูุตุบุฑุฉ ุงุญุชุฑุงููุฉ',
                '8 ุชุตูููุงุช ุจูุณุชุฑุฒ ููุณูุดูุงู ููุฏูุง ููุฅุนูุงูุงุช',
                '4 ููุฏูููุงุช ุฑููุฒ ูููุฉ',
                'ุชุตููู ุบูุงู ูุฐูุฑุฉ',
                'ุชุตููู ุจูุณุชุฑ ููุงููู ุฃู ููุฎุต',
                'ุดูุงุฏุฉ ุชูุฏูุฑ',
                'ููู ุฅุฏุงุฑุฉ ุฌุฏููุฉ ุงูุญููุงุช ุงูุฅุนูุงููุฉ ูุฌุงูุงู (Setup & Monitoring)',
                'ูุตุงุฆุญ ูุชุญุณูู ุงูุธููุฑ ุฃูุงู ุงููุงููุฑุง'
            ],
            price: '6000 EGP <span style="font-size:0.5em; text-decoration:line-through; color:#aaa">6500</span>'
        },
        'vip': {
            title: 'ุจุงูุฉ ุงูุงูุชุดุงุฑ ูุงูุชุฑููุฏ',
            image: '../images/BAC3.png',
            audience: 'ููุฃูุงุฏูููุงุช ูุงููุฏุฑุณูู ุงููุจุงุฑ ุงูุจุงุญุซูู ุนู ุงูุชูุณุน ุงูุณุฑูุน ูุงูุณูุทุฑุฉ ุนูู ุงูููุตุงุช.',
            features: [
                '6 ููุฏูููุงุช ุดุฑุญ ุทูููุฉ (ููุชููุจ/ููุณุจูู)',
                '3 ููุฏูููุงุช ุฑููุฒ ุณุฑูุนุฉ ุงูุงูุชุดุงุฑ (Viral Style)',
                '6 ุตูุฑ ูุตุบุฑุฉ ุนุงููุฉ ุงูุฌูุฏุฉ',
                '6 ุจูุณุชุฑุงุช ุฅุนูุงููุฉ ูููุฉ',
                'ุฎุทุฉ ูุญุชูู ุชูุงุนููุฉ ูุฒูุงุฏุฉ ุงููุชุงุจุนูู',
                'ุฃููููุฉ ูุตูู ูู ุงูุชูููุฐ ูุงูุชุนุฏููุงุช',
                '2 ุจูุณุชุฑ ุงูููุงููู ูุฑุงุฌุนุฉ'
            ],
            price: '4250 EGP <span style="font-size:0.5em; text-decoration:line-through; color:#aaa">5000</span>'
        }
    };

    const packageOverlay = document.getElementById('package-overlay');
    const closeOverlayBtn = document.querySelector('.close-overlay');
    const viewDetailBtns = document.querySelectorAll('.view-package-detail');
    const pkgBookBtn = document.getElementById('pkg-book-btn');
    const pkgTitle = document.getElementById('pkg-title');
    const pkgImg = document.getElementById('pkg-img');
    const pkgAudience = document.getElementById('pkg-audience');
    const pkgFeatures = document.getElementById('pkg-features');
    const pkgPrice = document.getElementById('pkg-price');

    let currentSelectedPackageId = '';

    viewDetailBtns.forEach(btn => {
        btn.addEventListener('click', (e) => {
            e.preventDefault();
            const pkgId = btn.getAttribute('data-package-id');
            const data = packagesData[pkgId];

            if (data) {
                currentSelectedPackageId = pkgId;
                pkgTitle.innerText = data.title;
                pkgImg.src = data.image;
                pkgImg.onerror = function () { this.src = 'https://placehold.co/800x400/04364A/64CCC5?text=Package+Image'; };
                pkgAudience.innerText = data.audience;
                pkgPrice.innerHTML = data.price;

                pkgFeatures.innerHTML = '';
                data.features.forEach(feat => {
                    const li = document.createElement('li');
                    li.innerHTML = `<i class="fas fa-check-circle"></i> ${feat}`;
                    pkgFeatures.appendChild(li);
                });

                packageOverlay.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        });
    });

    if (closeOverlayBtn) {
        closeOverlayBtn.addEventListener('click', () => {
            packageOverlay.classList.remove('active');
            document.body.style.overflow = 'auto';
        });
    }

    if (pkgBookBtn) {
        pkgBookBtn.addEventListener('click', () => {
            openWizard(currentSelectedPackageId);
        });
    }

    // --- WIZARD FORM LOGIC ---
    const wizardModal = document.getElementById('wizard-modal');
    const closeWizardBtn = document.querySelector('.close-modal');
    const wizardForm = document.getElementById('wizard-form');
    const nextBtn = document.getElementById('nextBtn');
    const prevBtn = document.getElementById('prevBtn');
    const steps = document.querySelectorAll('.step');
    const progressFill = document.getElementById('progress-fill');
    let currentStep = 1;
    let selectedPackageName = "";

    function openWizard(pkgId) {
        const map = { 'basic': 'ุจุงูุฉ ุงููุชุงุจุนุฉ ุงูุฃุณุจูุนูุฉ', 'pro': 'ุจุงูุฉ ุงููููุฌ ุงูููุซู', 'vip': 'ุจุงูุฉ ุงูุงูุชุดุงุฑ ูุงูุชุฑููุฏ' };
        selectedPackageName = map[pkgId] || "ุจุงูุฉ ุบูุฑ ูุญุฏุฏุฉ";
        wizardModal.classList.add('active');
    }

    if (closeWizardBtn) {
        closeWizardBtn.addEventListener('click', () => {
            wizardModal.classList.remove('active');
            if (!packageOverlay.classList.contains('active')) {
                document.body.style.overflow = 'auto';
            }
        });
    }

    function updateWizard() {
        steps.forEach(step => {
            step.classList.remove('active');
            if (parseInt(step.dataset.step) === currentStep) {
                step.classList.add('active');
            }
        });
        const progress = ((currentStep - 1) / (steps.length - 1)) * 100;
        if (progressFill) progressFill.style.width = `${progress}%`;

        if (currentStep === 1) {
            prevBtn.style.display = 'none';
            nextBtn.textContent = 'ุงูุชุงูู';
        } else if (currentStep === steps.length) {
            prevBtn.style.display = 'inline-block';
            nextBtn.textContent = 'ุฅุฑุณุงู ุงูุทูุจ (WhatsApp)';
        } else {
            prevBtn.style.display = 'inline-block';
            nextBtn.textContent = 'ุงูุชุงูู';
        }
    }

    if (nextBtn && prevBtn) {
        nextBtn.addEventListener('click', (e) => {
            e.preventDefault();
            const currentStepEl = document.querySelector(`.step[data-step="${currentStep}"]`);
            const inputs = currentStepEl.querySelectorAll('input[required], select[required]');
            let valid = true;
            inputs.forEach(i => { if (!i.checkValidity()) { i.reportValidity(); valid = false; } });

            if (valid) {
                if (currentStep < steps.length) {
                    currentStep++;
                    updateWizard();
                } else {
                    sendToWhatsApp();
                }
            }
        });

        prevBtn.addEventListener('click', (e) => {
            e.preventDefault();
            if (currentStep > 1) { currentStep--; updateWizard(); }
        });
    }

    function sendToWhatsApp() {
        const formData = new FormData(wizardForm);
        const data = Object.fromEntries(formData.entries());

        const goals = [];
        document.querySelectorAll('input[name="goal"]:checked').forEach(cb => goals.push(cb.value));
        const platforms = [];
        document.querySelectorAll('input[name="platform"]:checked').forEach(cb => platforms.push(cb.value));

        let message = `*ุทูุจ ุฌุฏูุฏ ูู ุงููููุน ๐*\n\n`;
        message += `*ุงูุจุงูุฉ ุงููุฎุชุงุฑุฉ:* ${selectedPackageName}\n`;
        message += `*ุงูุงุณู:* ${data.name || ''}\n`;
        message += `*ุฑูู ุงููุงุชู:* ${data.phone || ''}\n`;
        message += `*ุงูุตูุฉ:* ${data.role || ''}\n\n`;

        message += `--- ุชูุงุตูู ุงููุดุฑูุน ---\n`;
        message += `*ุงููุฏู:* ${goals.join('ุ ')}\n`;
        message += `*ุงูุฎุฏูุฉ:* ${data.service}\n`;
        message += `*ุงููุถุน ุงูุญุงูู:* ${data.status}\n\n`;

        message += `--- ุงูุฌูููุฑ ูุงูุณุชุงูู ูุงููููุฉ ---\n`;
        message += `*ุงูุฌูููุฑ:* ${data.audience || 'ุบูุฑ ูุญุฏุฏ'}\n`;
        message += `*ุงูุณุชุงูู:* ${data.style || 'ุบูุฑ ูุญุฏุฏ'}\n`;
        message += `*ุงูููุตุงุช:* ${platforms.join('ุ ')}\n\n`;

        message += `--- ุงูููุนุฏ ---\n`;
        message += `*ุงูููุนุฏ:* ${data.timeline || 'ุบูุฑ ูุญุฏุฏ'}\n`;

        const encodedMessage = encodeURIComponent(message);
        const whatsappURL = `https://wa.me/201062680608?text=${encodedMessage}`;

        window.open(whatsappURL, '_blank');

        setTimeout(() => {
            wizardModal.classList.remove('active');
            packageOverlay.classList.remove('active');
            document.body.style.overflow = 'auto';
            currentStep = 1;
        }, 1000);
    }

    // --- CUSTOM PACKAGE LOGIC (UPDATED) ---
    const customInputs = document.querySelectorAll('.custom-pkg-wrapper .qty-input');
    const calcCustomBtn = document.getElementById('calc-custom-btn');
    const customSummary = document.getElementById('custom-summary');
    const newTotalDisplay = document.getElementById('new-total-display');
    const oldTotalDisplay = document.getElementById('old-total-display');
    const savingsDisplay = document.getElementById('savings-display');
    const sendCustomOrderBtn = document.getElementById('send-custom-order');
    const reCalcBtn = document.getElementById('re-calc-btn');

    // Helper to calculate totals
    function calculateTotals() {
        let totalNew = 0;

        // 1. Calculate Filming (Special Logic: Lectures * HoursPerLec * rate)
        const filmLecInput = document.querySelector('.film-lectures-input');
        const filmHourInput = document.querySelector('.film-hours-input');

        if (filmLecInput && filmHourInput) {
            const lectures = parseInt(filmLecInput.value) || 0;
            const hoursPerLec = parseInt(filmHourInput.value) || 0;
            const rate = 150; // Rate per hour

            if (lectures > 0 && hoursPerLec > 0) {
                totalNew += (lectures * hoursPerLec * rate);
            }
        }

        // 2. Calculate Other Inputs
        customInputs.forEach(input => {
            // Skip filming inputs as they are handled above
            if (input.classList.contains('film-lectures-input') || input.classList.contains('film-hours-input')) return;

            const price = parseFloat(input.dataset.price);
            const qty = parseInt(input.value) || 0;
            if (qty > 0) {
                totalNew += price * qty;
            }
        });

        return { totalNew };
    }

    // Input Step Buttons
    document.querySelectorAll('.qty-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            e.preventDefault();
            const input = btn.parentElement.querySelector('input');
            let val = parseInt(input.value) || 0;
            if (btn.classList.contains('plus')) {
                val++;
            } else {
                if (val > 0) val--;
            }
            input.value = val;
            // Hide summary if user changes quantity, forcing them to re-calculate
            if (customSummary) customSummary.style.display = 'none';
            if (calcCustomBtn) calcCustomBtn.style.display = 'inline-block';
        });
    });

    // Reset view if input changes manually
    if (customInputs) {
        customInputs.forEach(inp => {
            inp.addEventListener('input', () => {
                if (customSummary) customSummary.style.display = 'none';
                if (calcCustomBtn) calcCustomBtn.style.display = 'inline-block';
            });
        });
    }

    // Calculate Button Click
    if (calcCustomBtn) {
        calcCustomBtn.addEventListener('click', () => {
            const { totalNew } = calculateTotals();

            if (totalNew === 0) {
                // Determine current lang for alert
                const lang = document.documentElement.lang || 'ar';
                const msg = lang === 'ar' ? 'ูุฑุฌู ุงุฎุชูุงุฑ ุฎุฏูุฉ ูุงุญุฏุฉ ุนูู ุงูุฃูู.' : 'Please select at least one service.';
                alert(msg);
                return;
            }

            // Update displays
            if (newTotalDisplay) newTotalDisplay.innerText = totalNew;

            // Show summary, hide calc button
            if (customSummary) customSummary.style.display = 'block';
            if (calcCustomBtn) calcCustomBtn.style.display = 'none';
        });
    }

    // Edit Button Click
    if (reCalcBtn) {
        reCalcBtn.addEventListener('click', () => {
            if (customSummary) customSummary.style.display = 'none';
            if (calcCustomBtn) calcCustomBtn.style.display = 'inline-block';
        });
    }

    // Send WhatsApp
    if (sendCustomOrderBtn) {
        sendCustomOrderBtn.addEventListener('click', () => {
            let items = [];
            const { totalNew } = calculateTotals();

            // 1. Add Filming Item
            const filmLecInput = document.querySelector('.film-lectures-input');
            const filmHourInput = document.querySelector('.film-hours-input');
            if (filmLecInput && filmHourInput) {
                const lectures = parseInt(filmLecInput.value) || 0;
                const hours = parseInt(filmHourInput.value) || 0;
                if (lectures > 0 && hours > 0) {
                    const cost = lectures * hours * 150;
                    items.push(`- ุชุตููุฑ ูุญุงุถุฑุงุช: ${lectures} ูุญุงุถุฑุงุช ร ${hours} ุณุงุนุงุช (ุงูุฅุฌูุงูู: ${cost} EGP)`);
                }
            }

            // 2. Add Other Items
            customInputs.forEach(input => {
                if (input.classList.contains('film-lectures-input') || input.classList.contains('film-hours-input')) return;

                const qty = parseInt(input.value) || 0;
                if (qty > 0) {
                    const name = input.dataset.name;
                    const price = parseFloat(input.dataset.price);
                    items.push(`- ${name}: ${qty} (ุณุนุฑ: ${price * qty} EGP)`);
                }
            });

            if (items.length === 0) return;

            let msg = `*ุทูุจ ุจุงูุฉ ูุฎุตุตุฉ (Custom Package)* ๐๏ธ\n\n`;
            msg += items.join('\n');
            msg += `\n\n*ุงูุฅุฌูุงูู (Individual Price):* ${totalNew} EGP`;
            msg += `\n\nุฃุฑุบุจ ูู ุชูููุฐ ูุฐู ุงูุฎุฏูุงุช.`;

            const url = `https://wa.me/201062680608?text=${encodeURIComponent(msg)}`;
            window.open(url, '_blank');
        });
    }

});
